<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE LIFF Share Demo</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
            display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏° */
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: #00B900;
            color: white;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;
        }
        .loading h1 {
            color: white;
            margin-bottom: 20px;
        }
        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        h1 {
            text-align: center;
            color: #00B900;
            margin-bottom: 30px;
        }
        .share-btn {
            background: #00B900;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
        }
        .share-btn:hover {
            background: #009900;
        }
        .share-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .message-preview {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #00B900;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì§ LINE Share Demo</h1>
        
        <div class="message-preview">
            <h3>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Flex Message ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏ä‡∏£‡πå:</h3>
            <p><strong>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:</strong> ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏à‡∏≤‡∏Å LIFF App!</p>
            <p><strong>‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤:</strong> ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å ShareTargetPicker</p>
        </div>

        <button id="shareBtn" class="share-btn" onclick="shareMessage()" disabled>
            üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ä‡∏£‡πå
        </button>

        <button id="shareGroupBtn" class="share-btn" onclick="shareToGroup()" disabled>
            üë• ‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
        </button>

        <div id="status"></div>
    </div>

    <script>
        // Initialize LIFF
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing LIFF...');
            
            liff.init({
                liffId: '1661515542-YKEGoQXj'
            }).then(() => {
                console.log('‚úÖ LIFF initialized successfully');
                
                if (!liff.isLoggedIn()) {
                    console.log('üîë Not logged in, redirecting to login...');
                    liff.login();
                } else {
                    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å ShareTargetPicker ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
                    immediateShare();
                }
            }).catch((err) => {
                console.error('‚ùå LIFF initialization failed:', err);
                showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö LINE ‡πÑ‡∏î‡πâ: ' + err.message);
            });
        });

        // ‡πÅ‡∏ä‡∏£‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ UI
        async function immediateShare() {
            console.log('üöÄ Starting immediate share...');
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô LINE app ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (!liff.isInClient()) {
                showError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô LINE App ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ShareTargetPicker');
                return;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ shareTargetPicker ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (!liff.isApiAvailable('shareTargetPicker')) {
                showError('ShareTargetPicker ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                return;
            }

            try {
                const flexMessage = createFlexMessage();
                console.log('üì§ Opening ShareTargetPicker immediately...');
                
                // ‡πÄ‡∏õ‡∏¥‡∏î ShareTargetPicker ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                const result = await liff.shareTargetPicker([flexMessage]);
                
                console.log('‚úÖ ShareTargetPicker result:', result);
                
                if (result) {
                    console.log('üéâ Share successful, closing LIFF...');
                    // ‡∏õ‡∏¥‡∏î LIFF ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ä‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    liff.closeWindow();
                } else {
                    console.log('‚ùå Share cancelled, closing LIFF...');
                    // ‡∏õ‡∏¥‡∏î LIFF ‡∏´‡∏≤‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå
                    liff.closeWindow();
                }
                
            } catch (error) {
                console.error('‚ùå Share error:', error);
                showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå: ' + (error.message || error));
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á Error ‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤ UI ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤
        function showError(message) {
            document.getElementById('loadingScreen').style.display = 'none';
            document.querySelector('.container').style.display = 'block';
            document.body.style.display = 'block';
            
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = 'status error';
            
            // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏£‡∏≠‡∏á
            document.getElementById('shareBtn').disabled = false;
            document.getElementById('shareGroupBtn').disabled = false;
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Flex Message
        function createFlexMessage() {
            return {
                type: 'flex',
                altText: 'üì£ ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏°‡∏ó‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢ Mini App + Google Apps Script ‡∏î‡∏∂‡∏á API ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢',
                contents: {
                      "type": "carousel",
                      "contents": [
                        {
                          "type": "bubble",
                          "size": "mega",
                          "header": {
                            "type": "box",
                            "layout": "vertical",
                            "paddingAll": "20px",
                            "backgroundColor": "#A980D8",
                            "contents": [
                              {
                                "type": "text",
                                "text": "üìö ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏°‡∏ó‡∏≠‡∏á",
                                "weight": "bold",
                                "size": "lg",
                                "color": "#ffffff"
                              },
                              {
                                "type": "text",
                                "text": "‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å & ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥",
                                "wrap": true,
                                "color": "#ffffff",
                                "size": "sm"
                              }
                            ]
                          },
                          "hero": {
                            "type": "image",
                            "url": "https://iili.io/FuZbEep.jpg",
                            "size": "full",
                            "aspectRatio": "1:1",
                            "aspectMode": "cover"
                          },
                          "body": {
                            "type": "box",
                            "layout": "vertical",
                            "spacing": "md",
                            "contents": [
                              {
                                "type": "text",
                                "text": "üîπ ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å",
                                "weight": "bold",
                                "color": "#7D4FC0",
                                "size": "md"
                              },
                              {
                                "type": "text",
                                "wrap": true,
                                "size": "sm",
                                "text": "‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏°‡∏ó‡∏≠‡∏á\n‚úÖ ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö (‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤, ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢, ‡πÄ‡∏ï‡∏¥‡∏°‡∏ñ‡∏≠‡∏ô)\n‚úÖ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏ô Mini App ‡πÅ‡∏•‡∏∞ LIFF\n‚úÖ ‡πÅ‡∏¢‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (User & Admin)"
                              },
                              {
                                "type": "text",
                                "text": "üîπ API ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥",
                                "weight": "bold",
                                "color": "#7D4FC0",
                                "size": "md"
                              },
                              {
                                "type": "text",
                                "wrap": true,
                                "size": "sm",
                                "text": "‚úÖ ‡πÅ‡∏´‡∏•‡πà‡∏á API ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥\n‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå\n‚úÖ ‡∏ï‡∏±‡πâ‡∏á Cron job ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏Ñ‡∏≤\n‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö"
                              }
                            ]
                          }
                        },
                        {
                          "type": "bubble",
                          "size": "mega",
                          "header": {
                            "type": "box",
                            "layout": "vertical",
                            "paddingAll": "20px",
                            "backgroundColor": "#C19DF7",
                            "contents": [
                              {
                                "type": "text",
                                "text": "üí∞ ‡πÄ‡∏ï‡∏¥‡∏°/‡∏ñ‡∏≠‡∏ô/‡∏ã‡∏∑‡πâ‡∏≠-‡∏Ç‡∏≤‡∏¢",
                                "weight": "bold",
                                "size": "lg",
                                "color": "#ffffff"
                              },
                              {
                                "type": "text",
                                "text": "‡∏£‡∏∞‡∏ö‡∏ö‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥",
                                "wrap": true,
                                "color": "#ffffff",
                                "size": "sm"
                              }
                            ]
                          },
                          "body": {
                            "type": "box",
                            "layout": "vertical",
                            "spacing": "md",
                            "contents": [
                              {
                                "type": "text",
                                "text": "üîπ ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô",
                                "weight": "bold",
                                "color": "#7D4FC0",
                                "size": "md"
                              },
                              {
                                "type": "text",
                                "wrap": true,
                                "size": "sm",
                                "text": "‚úÖ ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö\n‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ + ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Google Drive\n‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Google Sheet\n‚úÖ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô\n‚úÖ ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥"
                              },
                              {
                                "type": "text",
                                "text": "üîπ ‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô",
                                "weight": "bold",
                                "color": "#7D4FC0",
                                "size": "md"
                              },
                              {
                                "type": "text",
                                "wrap": true,
                                "size": "sm",
                                "text": "‚úÖ ‡∏Ç‡∏≠‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°\n‚úÖ ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥\n‚úÖ ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡∏à‡∏≥‡∏•‡∏≠‡∏á)"
                              },
                              {
                                "type": "text",
                                "text": "üîπ ‡∏ã‡∏∑‡πâ‡∏≠/‡∏Ç‡∏≤‡∏¢‡∏ó‡∏≠‡∏á",
                                "weight": "bold",
                                "color": "#7D4FC0",
                                "size": "md"
                              },
                              {
                                "type": "text",
                                "wrap": true,
                                "size": "sm",
                                "text": "‚úÖ ‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô\n‚úÖ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥\n‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏î‡∏ó‡∏≠‡∏á‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ\n‚úÖ ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤"
                              }
                            ]
                          }
                        },
                        {
                          "type": "bubble",
                          "size": "mega",
                          "header": {
                            "type": "box",
                            "layout": "vertical",
                            "paddingAll": "20px",
                            "backgroundColor": "#7D4FC0",
                            "contents": [
                              {
                                "type": "text",
                                "text": "üì¶ ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ & ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£",
                                "weight": "bold",
                                "size": "lg",
                                "color": "#ffffff"
                              },
                              {
                                "type": "text",
                                "text": "‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô & LIFF & Mini App",
                                "wrap": true,
                                "color": "#ffffff",
                                "size": "sm"
                              }
                            ]
                          },
                          "body": {
                            "type": "box",
                            "layout": "vertical",
                            "spacing": "md",
                            "contents": [
                              {
                                "type": "text",
                                "text": "üîπ ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ & ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥",
                                "weight": "bold",
                                "color": "#7D4FC0",
                                "size": "md"
                              },
                              {
                                "type": "text",
                                "wrap": true,
                                "size": "sm",
                                "text": "‚úÖ ‡∏î‡∏π‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô/‡∏ó‡∏≠‡∏á‡∏™‡∏∞‡∏™‡∏°\n‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå\n‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á (‡πÄ‡∏ï‡∏¥‡∏°, ‡∏ñ‡∏≠‡∏ô, ‡∏ã‡∏∑‡πâ‡∏≠, ‡∏Ç‡∏≤‡∏¢)"
                              },
                              {
                                "type": "text",
                                "text": "üîπ ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô",
                                "weight": "bold",
                                "color": "#7D4FC0",
                                "size": "md"
                              },
                              {
                                "type": "text",
                                "wrap": true,
                                "size": "sm",
                                "text": "‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô\n‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö/‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°\n‚úÖ ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò/‡∏•‡∏ö‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥\n‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"
                              },
                              {
                                "type": "text",
                                "text": "üîπ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏ú‡πà‡∏≤‡∏ô LIFF",
                                "weight": "bold",
                                "color": "#7D4FC0",
                                "size": "md"
                              },
                              {
                                "type": "text",
                                "wrap": true,
                                "size": "sm",
                                "text": "‚úÖ UI HTML/CSS + Tailwind ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö LIFF\n‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° Google Apps Script ‡∏Å‡∏±‡∏ö Web App\n‚úÖ Deploy ‡∏ú‡πà‡∏≤‡∏ô LIFF ID\n‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ú‡πà‡∏≤‡∏ô Rich Menu / Flex\n‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á"
                              }
                            ]
                          },
                          "footer": {
                            "type": "box",
                            "layout": "vertical",
                            "spacing": "sm",
                            "contents": [
                              {
                                "type": "box",
                                "layout": "horizontal",
                                "contents": [
                                  {
                                    "type": "button",
                                    "style": "primary",
                                    "flex": 5,
                                    "action": {
                                      "type": "message",
                                      "label": "üìö‡∏•‡∏á‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏ô‡∏µ‡πâ",
                                      "text": "‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏°‡∏ó‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ôminiapp‡πÅ‡∏•‡∏∞LIFF"
                                    }
                                  },
                                  {
                                    "type": "button",
                                    "style": "secondary",
                                    "color": "#8C9EFF",
                                    "flex": 5,
                                    "action": {
                                      "type": "message",
                                      "label": "üèÜ Demo",
                                      "text": "hello"
                                    },
                                    "offsetStart": "2px",
                                    "offsetEnd": "2px"
                                  }
                                ]
                              },
                              {
                                "type": "button",
                                "style": "primary",
                                "margin": "md",
                                "action": {
                                  "type": "uri",
                                  "label": "üé• ‡∏î‡∏π‡∏Ñ‡∏•‡∏¥‡∏õ Demo",
                                  "uri": "https://youtube.com/shorts/9nW2i3UCLbg?si=BrD-6wd2Gr_dv2Je"
                                },
                                "color": "#fa1805"
                              }
                            ]
                          }
                        }
                      ]
                    }
            };
        }

        // ‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏î‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô
        async function shareMessage() {
            console.log('üéØ Share button clicked');
            
            if (!liff.isLoggedIn()) {
                showStatus('üîë ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö LINE ‡∏Å‡πà‡∏≠‡∏ô', 'error');
                liff.login();
                return;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô LINE app ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (!liff.isInClient()) {
                showStatus('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô LINE App ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ShareTargetPicker', 'error');
                return;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ shareTargetPicker ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (!liff.isApiAvailable('shareTargetPicker')) {
                showStatus('‚ùå ShareTargetPicker ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', 'error');
                console.error('shareTargetPicker is not available. Available APIs:', {
                    shareTargetPicker: liff.isApiAvailable('shareTargetPicker'),
                    sendMessages: liff.isApiAvailable('sendMessages'),
                    openWindow: liff.isApiAvailable('openWindow'),
                    scanCode: liff.isApiAvailable('scanCode')
                });
                return;
            }

            try {
                showStatus('‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô...', 'success');
                
                // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
                document.getElementById('shareBtn').disabled = true;
                
                const flexMessage = createFlexMessage();
                console.log('üì§ Calling shareTargetPicker with message:', flexMessage);
                
                // ‡πÄ‡∏õ‡∏¥‡∏î ShareTargetPicker
                const result = await liff.shareTargetPicker([flexMessage]);
                
                console.log('‚úÖ ShareTargetPicker result:', result);
                
                                if (result) {
                    showStatus('üéâ ‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    
                    // ‡∏õ‡∏¥‡∏î LIFF ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏™‡∏£‡πá‡∏à (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
                    setTimeout(() => {
                        showStatus('‚úÖ ‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á...', 'success');
                        setTimeout(() => {
                            liff.closeWindow();
                        }, 2000);
                    }, 1000);
                    
                } else {
                    showStatus('‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå', 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Share error details:', error);
                
                let errorMessage = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå';
                
                if (error.code) {
                    switch (error.code) {
                        case 'FORBIDDEN':
                            errorMessage = 'üö´ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ LIFF';
                            break;
                        case 'INTERNAL_ERROR':
                            errorMessage = '‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
                            break;
                        case 'INVALID_ARGUMENT':
                            errorMessage = 'üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                            break;
                        default:
                            errorMessage = `‚ùå Error Code: ${error.code} - ${error.message || error}`;
                    }
                } else {
                    errorMessage = '‚ùå ' + (error.message || error.toString());
                }
                
                showStatus(errorMessage, 'error');
                
            } finally {
                // ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                document.getElementById('shareBtn').disabled = false;
            }
        }

        // ‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        async function shareToGroup() {
            if (!liff.isLoggedIn()) {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö LINE ‡∏Å‡πà‡∏≠‡∏ô', 'error');
                return;
            }

            try {
                const context = liff.getContext();
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                if (context.type !== 'group' && context.type !== 'room') {
                    showStatus('‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'error');
                    return;
                }

                const flexMessage = createFlexMessage();
                
                // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                await liff.sendMessages([flexMessage]);
                showStatus('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ', 'success');
                
            } catch (error) {
                console.error('Send message error:', error);
                showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: ' + error.message, 'error');
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setTimeout(() => {
                statusDiv.textContent = '';
                statusDiv.className = 'status';
            }, 3000);
        }
    </script>
</body>
</html>
