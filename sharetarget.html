<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE LIFF Share Demo</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/versions/2.21.4/sdk.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #00B900;
            margin-bottom: 30px;
        }
        .share-btn {
            background: #00B900;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
        }
        .share-btn:hover {
            background: #009900;
        }
        .share-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .message-preview {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #00B900;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì§ LINE Share Demo</h1>

        <div class="message-preview">
            <h3>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Flex Message ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏ä‡∏£‡πå:</h3>
            <p><strong>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:</strong> ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏à‡∏≤‡∏Å LIFF App!</p>
            <p><strong>‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤:</strong> ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å ShareTargetPicker</p>
        </div>
        <button id="shareBtn" class="share-btn" onclick="shareMessage()">
            üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ä‡∏£‡πå
        </button>
        <button id="shareGroupBtn" class="share-btn" onclick="shareToGroup()">
            üë• ‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
        </button>
        <div id="status"></div>
    </div>
    <script>
        // Initialize LIFF
        window.onload = function() {
            liff.init({
                liffId: '1661515542-YKEGoQXj' // Replace with your LIFF ID
            }).then(() => {
                console.log('LIFF initialized successfully');
                console.log('LIFF isLoggedIn:', liff.isLoggedIn());
                console.log('LIFF Context:', liff.getContext());

                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    showStatus('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                }
            }).catch((err) => {
                console.error('LIFF initialization failed', err);
                showStatus('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö LINE ‡πÑ‡∏î‡πâ: ' + err.message, 'error');
            });
        };

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Flex Message
        function createFlexMessage() {
            return {
                type: 'flex',
                altText: '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏à‡∏≤‡∏Å LIFF App!',
                contents: {
                    type: 'bubble',
                    hero: {
                        type: 'image',
                        url: 'https://miro.medium.com/v2/resize:fit:4800/format:webp/1*sE8GWedeZd6qpVG9HYu-lg.jpeg',
                        size: 'full',
                        aspectRatio: '20:13',
                        aspectMode: 'cover'
                    },
                    body: {
                        type: 'box',
                        layout: 'vertical',
                        contents: [
                            {
                                type: 'text',
                                text: 'üéâ ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏à‡∏≤‡∏Å LIFF App!',
                                weight: 'bold',
                                size: 'xl',
                                color: '#00B900'
                            },
                            {
                                type: 'text',
                                text: '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô ShareTargetPicker',
                                size: 'sm',
                                color: '#666666',
                                margin: 'md',
                                wrap: true
                            },
                            {
                                type: 'separator',
                                margin: 'md'
                            },
                            {
                                type: 'box',
                                layout: 'vertical',
                                margin: 'md',
                                contents: [
                                    {
                                        type: 'text',
                                        text: 'üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ' + new Date().toLocaleDateString('th-TH'),
                                        size: 'sm',
                                        color: '#888888'
                                    },
                                    {
                                        type: 'text',
                                        text: '‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤: ' + new Date().toLocaleTimeString('th-TH'),
                                        size: 'sm',
                                        color: '#888888'
                                    }
                                ]
                            }
                        ]
                    },
                    footer: {
                        type: 'box',
                        layout: 'vertical',
                        contents: [
                            {
                                type: 'button',
                                style: 'primary',
                                height: 'sm',
                                action: {
                                    type: 'uri',
                                    label: 'üîó ‡πÄ‡∏õ‡∏¥‡∏î LIFF App',
                                    uri: 'https://line.me/R/app/1661515542-YKEGoQXj' // Replace with your LIFF ID
                                }
                            }
                        ]
                    }
                }
            };
        }

        // ‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏î‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô
        async function shareMessage() {
            console.log('Share button clicked');

            if (!liff.isLoggedIn()) {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö LINE ‡∏Å‡πà‡∏≠‡∏ô', 'error');
                liff.login();
                return;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ shareTargetPicker ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (!liff.isApiAvailable('shareTargetPicker')) {
                showStatus('ShareTargetPicker ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ', 'error');
                console.error('shareTargetPicker is not available');
                return;
            }

            try {
                showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô...', 'success');
                const flexMessage = createFlexMessage();

                console.log('Calling shareTargetPicker with message:', flexMessage);

                // ‡πÄ‡∏õ‡∏¥‡∏î ShareTargetPicker
                const result = await liff.shareTargetPicker([flexMessage]);

                console.log('ShareTargetPicker result:', result);

                if (result) {
                    showStatus('‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ', 'success');
                    console.log('Share success:', result);
                } else {
                    showStatus('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå', 'error');
                }

            } catch (error) {
                console.error('Share error details:', error);

                if (error.code === 'FORBIDDEN') {
                    showStatus('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ LIFF', 'error');
                } else if (error.code === 'INTERNAL_ERROR') {
                    showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
                } else {
                    showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå: ' + (error.message || error), 'error');
                }
            }
        }

        // ‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        async function shareToGroup() {
            if (!liff.isLoggedIn()) {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö LINE ‡∏Å‡πà‡∏≠‡∏ô', 'error');
                return;
            }

            try {
                const context = liff.getContext();

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                if (context.type !== 'group' && context.type !== 'room') {
                    showStatus('‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'error');
                    return;
                }

                const flexMessage = createFlexMessage();

                // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                await liff.sendMessages([flexMessage]);
                showStatus('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ', 'success');

            } catch (error) {
                console.error('Send message error:', error);
                showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: ' + error.message, 'error');
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;

            // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setTimeout(() => {
                statusDiv.textContent = '';
                statusDiv.className = 'status';
            }, 3000);
        }
    </script>
</body>
</html>
